function itemsizeMouseOn(){itemShowPrice(this)}
function itemsizeMouseOff(){itemShowPrice()}
function itemsizeClick(){document.querySelectorAll('.js-itemsize').forEach((item)=>{item.setAttribute('data-state','')});this.setAttribute('data-state','active');itemShowPrice(this)}
function onLicenseChange(){clickedid=this.getAttribute('id');var selectedextendedlicenses=[];document.querySelectorAll('.js-extended').forEach((item)=>{if(item.checked==!0){if(!selectedextendedlicenses.includes(item.getAttribute('id')))
selectedextendedlicenses.push(item.getAttribute('id'));}});if(clickedid.startsWith('SR-')){selectedextendedlicenses.forEach((item)=>{if(item!=clickedid)
document.getElementById(item).checked=!1})}
if(!clickedid.startsWith('SR-')){selectedextendedlicenses.forEach((item)=>{if(item.startsWith('SR-'))
document.getElementById(item).checked=!1})}
itemShowPrice()}
async function showPostDownload(){const postdownload=document.querySelector('.js-postdownload-regular');if(postdownload){DT.UI.unset(postdownload);return}
const preview=document.querySelector('.js-item-preview');DT.UI.showLoading({element:preview,type:'area',theme:'light',positionRelative:!0,});await DT.insertTemplate('.js-postdownload-regular-tpl',preview);DT.UI.hideLoading(preview)}
async function continueWithWm(){const element=document.querySelector('.js-continue-wm');await DT.UI.showLoading({element:element,type:'btn',theme:'light',size:'sml',});window.location.assign(window.site_adr+DT.link);setTimeout(function(){closePostDownloadUpgrade();DT.UI.hideLoading(element)},3000)}
async function closePostDownloadUpgrade(){const post_download=document.querySelector('.post-download');if(!post_download)return;DT.UI.set(post_download,'hidden')}
async function upgradePlan(){const element=document.querySelector('.js-upgradeonthespot');const resp=await fetch('/ajax/ajax_renew.php').then(function(response){return response.json()}).then(async function(data){if(data.status==!0){await DT.UI.showLoading({element:element,type:'btn',theme:'light',size:'sml',});window.location.assign(window.site_adr+DT.link);document.querySelector('.js-upgraded-msg')?.setAttribute('data-state','');setTimeout(function(){closePostDownloadUpgrade();DT.UI.hideLoading(element)},3000)}else{window.location.href=data.redir_url;return!1}})}
async function showPostDownloadUpgrade(){const post_download=document.querySelector('.post-download');if(post_download==null){const preview=document.querySelector('.js-item-preview');DT.UI.showLoading({element:preview,type:'area',theme:'light',positionRelative:!0,});await DT.insertTemplate('.js-postdownload-upgrade-tpl',preview);DT.UI.hideLoading(preview);document.querySelector('.js-continue-wm').addEventListener("click",continueWithWm,!1);document.querySelector('.js-upgradeonthespot').addEventListener("click",upgradePlan,!1)}else{const post_download=document.querySelector('.post-download');if(!post_download)return;DT.UI.set(post_download,'')}}
async function clickDownload(){if(DT.renewed==1){location.reload();return!1}
var sel;if(sel===undefined){document.querySelectorAll('.js-itemsize').forEach((item)=>{if(item.getAttribute('data-state')=='active'){sel=item}})}
x=sel.getAttribute('id').replace('aid','');const element=document.querySelector('.js-download-button');itemShowPrice();if(DT.client==0){return!1}
if(DT.reqio>0){window.location.href=window.site_adr+'account/edit-profile?reqio=1&imageid='+DT.imageid;return!1}
await DT.UI.showLoading({element:element,type:'area',theme:'light',positionRelative:!0,size:'sml',});if(DT.link.indexOf('credits')!=-1){if(document.querySelector('.js-renew-plan-current')&&document.querySelector('.js-renew-plan-current').checked){const resp=await fetch('/ajax/ajax_renew.php?strict=2').then(function(response){return response.json()}).then(async function(data){if(data.status===!1){document.querySelector('.js-renew-plan-box-need-plan').innerHTML=DT.paymentfailed;document.querySelector('.js-renew-plan-box-need-plan').style.color='#ff1d8b';document.querySelector('.js-renew-plan-box-need-plan').style.fontWeight='bold';document.querySelector('.js-renew-plan-box-options').innerHTML='';setTimeout(function(){window.location.assign(data.redir_url)},1000);return!1}else{if(data.status===!0){DT.renewed=1;document.querySelector('.js-renew-plan-box-need-plan').innerHTML=DT.renewedtext;document.querySelector('.js-renew-plan-box-need-plan').style.color='#3F8600';document.querySelector('.js-renew-plan-box-need-plan').style.fontWeight='bold';document.querySelector('.js-renew-plan-box-options').innerHTML='';DT.link=getDownloadLink(x);var link=document.createElement('a');fetch(DT.link).then(response=>response.blob()).then(blob=>{var blobUrl=URL.createObjectURL(blob);link.href=blobUrl;var ext='.jpg';if(x=='tiff')
ext='.tiff';if(x=='add')
ext='.'+document.querySelector('.js-ext').toLowerCase();link.download='dreamstime_'+x+'_'+DT.imageid+ext;document.body.appendChild(link);link.click();document.body.removeChild(link);URL.revokeObjectURL(blobUrl)}).then(()=>{DT.UI.hideLoading(element)}).catch(error=>{console.error('Error:',error)})}
try{await showPostDownload()}catch(error){DT.log('error',error)}}});return!1}else{window.location.href=window.site_adr+DT.link;DT.UI.hideLoading(element);return!1}}
if(DT.link.indexOf('download2010.php')!=-1){const resp=await fetch('/ajax/ajax_wmft.php').then(function(response){return response.json()}).then(async function(data){DT.hasw=data.hasw;if(DT.hasw==1&&DT.availablecredits==0){showPostDownloadUpgrade()}else{try{await showPostDownload()}catch(error){DT.log('error',error)}
window.location.assign(window.site_adr+DT.link)}}).then(function(){DT.UI.hideLoading(element)})}}
function getDownloadLink(x){return window.site_adr+'download2010.php?in='+encodeURIComponent(DT.client+','+DT.imageid+',')+encodeURIComponent('1 ')+x}
function itemShowPrice(sel){var sel,x,price,altprice,appexts=-1;var selectedextendedlicenses=[];var extendedlicenseprice='0';var pricedisplay='Price: ';var dldext='';var addorsub=0;var SRselected='';document.querySelectorAll('.js-extended').forEach((item)=>{if(item.checked==!0){if(!selectedextendedlicenses.includes(item.getAttribute('id'))){selectedextendedlicenses.push(item.getAttribute('id'));if(item.getAttribute('id').startsWith('SR-')){extendedlicenseprice=item.getAttribute('data-price');SRselected=item.getAttribute('id').replace('-','')}else extendedlicenseprice=(parseInt(extendedlicenseprice,10)+parseInt(item.getAttribute('data-price'),10)).toString()}}});if(sel===undefined){document.querySelectorAll('.js-itemsize').forEach((item)=>{if(item.getAttribute('data-state')=='active'){sel=item}})}
x=sel.getAttribute('id').replace('aid','');price=sel.getAttribute('data-price');altprice=sel.getAttribute('data-alternateprice');if(altprice==undefined)
altprice=0;DT.link=getDownloadLink(x);if(extendedlicenseprice!='0'){price=extendedlicenseprice;altprice=0;appexts=DT.extsubsizes.length>0?1:0;selectedextendedlicenses.forEach((xx)=>{dldext=dldext+encodeURIComponent(',1 ')+xx.replace('-','');if(!DT.extsubsizes.includes(xx)){appexts=0}});if(appexts==1||DT.availablecredits>=price){DT.link='download2010.php?in='+encodeURIComponent(DT.client+','+DT.imageid+',')+encodeURIComponent('1 ')+x+dldext}else{DT.link=DT.creditslink+'&needstobuy='+price+'&nr_images=1'}}else{if(DT.subsizes.includes(x)||DT.availablecredits>=price){DT.link='download2010.php?in='+encodeURIComponent(DT.client+','+DT.imageid+',')+encodeURIComponent('1 ')+x}else{DT.link=DT.creditslink+'&needstobuy='+price+'&nr_images=1';addorsub=1}}
if(SRselected!=''){DT.link='securecredits2.php?imageid='+DT.imageid+'&srel='+SRselected+'&size=max'}
if(sel!==undefined){if(altprice!==undefined&&altprice>0&&altprice>price)
pricedisplay+='<span class="strikethrough">'+altprice+' '+(altprice==1?DT.credi_singular_txt:DT.credit_txt)+'</span>';if(addorsub)
pricedisplay+='<a href="/credits?needstobuy='+price+'&nr_images=1">';pricedisplay+='<strong>'+price+' ';if(SRselected=='')
pricedisplay+=(price==1?DT.credit_singular_txt:DT.credit_txt);pricedisplay+='</strong>';if(addorsub)
pricedisplay+='</a>';if(addorsub)
pricedisplay+=DT.orsubscription;if(DT.client>0)
document.querySelector('.js-item-price').innerHTML=pricedisplay;if(appexts==1||appexts==-1&&DT.subsizes.includes(x))
document.querySelector('.js-item-price').innerHTML='';if(document.querySelector('.js-credits-price')!==null)
document.querySelector('.js-credits-price').innerHTML=price+' '+(price==1?DT.credit_singular_txt:DT.credit_txt);}}
async function requestLicense(){var license=this.getAttribute('id').replace("request-","");var code=this.getAttribute('data-code');try
{const resp=await fetch('/ajax/image_details.php?area=12&code='+code+'&imageid='+DT.imageid+'&requested_imageid='+DT.imageid+'&add_request_comment='+license.replace('-EL',''));document.querySelector('.js-request-'+license).setAttribute('data-state','hidden');document.querySelector('.js-requested-'+license).setAttribute('data-state','active')}catch(_err){}}
function stripHtml(html){const tempElement=document.createElement("div");tempElement.innerHTML=html;return tempElement.textContent||tempElement.innerText||""}
function FT_itemsizeClick(){document.querySelectorAll('.js-itemsize').forEach((item)=>{item.setAttribute('data-state','')});var text=stripHtml(this.querySelector('.size__res').textContent).replace('px','px • ').replace('@',' • @');text=text+' • '+stripHtml(this.querySelector('.size__ext').textContent).replace('|',' • ');document.querySelector('.js-size-title').textContent=this.querySelector('.js-ext').textContent;document.querySelector('.js-size-info').textContent=text;document.querySelector('.js-dropdown-trigger').click()}
function FT_extendedClick(){clickedid=this.getAttribute('id');var selectedextendedlicenses=[];var selectedellicenses=[];document.querySelectorAll('.js-extended').forEach((item)=>{if(item.checked==!0){{if(!selectedextendedlicenses.includes(item.getAttribute('id')))
selectedextendedlicenses.push(item.getAttribute('id'));}}});if(clickedid.startsWith('SR-')){selectedextendedlicenses.forEach((item)=>{if(item!=clickedid){document.getElementById(item).checked=!1}});selectedextendedlicenses=[clickedid]}
if(!clickedid.startsWith('SR-')){selectedextendedlicenses.forEach((item)=>{if(item.startsWith('SR-')){document.getElementById(item).checked=!1;selectedextendedlicenses=selectedextendedlicenses.filter(element=>!element.startsWith('SR-'))}})}
selectedellicenses=selectedextendedlicenses.filter(element=>!element.startsWith('SR-'));if(selectedellicenses.length>0){var link=document.getElementById('free-trial-extended').getAttribute('data-download-url');var extended_alt=document.getElementsByName('extended-alt')[0].value.split("|||");if(selectedellicenses.length>2){document.querySelector('.js-download-button').setAttribute('data-download-url',link.replace("subscriptionid=1",extended_alt[2]));document.querySelector('.js-extended-plan-images').textContent=extended_alt[0];document.querySelector('.js-extended-plan-price').textContent=extended_alt[1]}else{document.querySelector('.js-download-button').setAttribute('data-download-url',link.replace(extended_alt[2],"subscriptionid=1"));document.querySelector('.js-extended-plan-images').textContent=2;document.querySelector('.js-extended-plan-price').textContent=document.getElementById('free-trial-extended').getAttribute('data-price')}
DT.UI.set(document.querySelector('.js-ft-plan'),'hidden');DT.UI.unset(document.querySelector('.js-extended-plan'),'hidden');document.getElementById('free-trial-extended').checked=!0;document.getElementById('free-trial-extended').dispatchEvent(new Event('change',{bubbles:!0}))}else{DT.UI.unset(document.querySelector('.js-ft-plan'),'hidden');DT.UI.set(document.querySelector('.js-extended-plan'),'hidden');document.getElementById('free-trial-sub').checked=!0;document.getElementById('free-trial-sub').dispatchEvent(new Event('change',{bubbles:!0}))}}
DT.onReady(()=>{const sidebarItem=document.querySelector('.item-download-plan');if(sidebarItem){document.querySelectorAll('.js-itemsize').forEach((item)=>{item.addEventListener("click",FT_itemsizeClick,!1)});document.querySelectorAll('.js-extended').forEach((item)=>{item.addEventListener("click",FT_extendedClick,!1)})}else{document.querySelectorAll('.js-itemsize').forEach((item)=>{item.addEventListener("mouseover",itemsizeMouseOn,!1);item.addEventListener("mouseout",itemsizeMouseOff,!1);item.addEventListener("click",itemsizeClick,!1)});document.querySelectorAll('.js-extended').forEach((item)=>{item.addEventListener("change",onLicenseChange,!1)});document.querySelectorAll('.js-request-license').forEach((lic)=>{lic.addEventListener("click",requestLicense,!1)});document.querySelector('.js-download-button').addEventListener("click",clickDownload,!1)}})